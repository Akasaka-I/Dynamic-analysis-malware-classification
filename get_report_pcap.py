import os
import json
import subprocess

FILE_PATH = './FileInfo/'
for file in os.listdir(FILE_PATH):
    with open(FILE_PATH + file, 'r') as file:
        info = json.load(file)
        filename = info["filename"]
        label = info["label"]
        task_id = str(info["task_id"])
    if not os.path.exists('./virusReport/' + label):
        os.makedirs('./virusReport/' + label)
    if not os.path.exists('./virusPcap/' + label):
        os.makedirs('./virusPcap/' + label)

    command1 = 'curl -o ./virusReport/' + label + '/' + filename + '.json -H "Authorization: Bearer mW54f6-LeqmcCfNRK0nZ0w" http://localhost:8090/tasks/report/' + task_id
    command2 = 'curl -H "Authorization: Bearer mW54f6-LeqmcCfNRK0nZ0w" http://localhost:8090/pcap/get/' + task_id +  '> ./virusPcap/' + label + '/' + filename + '.pcap'

    # first comment
    try:
        subprocess.run(command1, shell=True, check=True)
        print("first comment success")
        # second comment, if first is success
        try:
            subprocess.run(command2, shell=True, check=True)
            print("second commnet success")
        except subprocess.CalledProcessError:
            print("second comment failed")
    except subprocess.CalledProcessError:
        print("first comment failed")